h1. 規格驅動開發 (Spec-Driven Development) 指南

這份文件旨在詳細說明「規格驅動開發 (Spec-Driven Development, SDD)」的方法論，從目的、運作原理到具體執行步驟，以及在現代產品開發中的應用。

----

h2. 1. 目的 (Purpose)

規格驅動開發的核心目標在於 *「以規格為依歸，減少開發過程中的不確定性與重工」*。

* *消除歧義 (Clarity & Alignment)*：
** 在撰寫任何程式碼之前，先透過文字、圖表清晰定義產品行為。
** 確保產品經理 (PM)、設計師、工程師與利害關係人對「完成品」有共同的想像，避免「做出來不是我要的」的情況。
* *單一真理來源 (Single Source of Truth, SSOT)*：
** 規格書 (Spec) 即為專案的法律文件。所有的開發決策、測試案例都應回溯至規格書。
** 當系統行為不明確時，查閱規格書而非猜測程式碼。
* *提升開發效率 (Efficiency)*：
** 雖然前期撰寫規格需要時間，但能大幅減少後期的 Bug 修復與邏輯修改時間。
** 「想清楚再動手」永遠比「邊做邊改」更有效率。
* *促進自動化與協作 (Automation & Collaboration)*：
** 良好的規格可以作爲自動化測試的基礎 (如 TDD/BDD)。
** 前後端工程師可依據 API 規格 (如 OpenAPI) 平行開發，互不阻塞。

----

h2. 2. 運作方式 (How it works)

Spec-Driven 的運作邏輯是 *「由上而下、由抽象到具體」* 的過程。

{mermaid}
graph TD
    A["模糊需求 (Ambiguity)"] -->|"分析 & 定義"| B("規格 Spec")
    B -->|"作為合約"| C{"開發團隊 & Stakeholders"}
    C -->|"依據 Spec 實作"| D["程式碼 Implementation"]
    C -->|"依據 Spec 驗收"| E["測試 Tests"]
    D --> F("發布 Release")
{mermaid}

h3. 核心循環：

# *定義 (Define)*：將模糊的需求轉化為具體的規格描述 (Input/Output/Behavior)。
# *合約 (Contract)*：團隊對規格達成共識，鎖定範疇 (Scope)。
# *實作 (Implement)*：工程師僅負責將「規格」翻譯成「程式碼」，不需在寫 code 時重新設計邏輯。
# *驗證 (Verify)*：測試僅針對「是否符合規格」進行驗收。

{mermaid}
sequenceDiagram
    participant PM as 產品/需求方
    participant Spec as 規格書 (SSOT)
    participant Dev as 開發團隊
    participant QA as 測試驗收

    PM->>Spec: 1. 定義需求 (Define)
    Spec->>Dev: 2. 確認合約 (Contract)
    Dev->>Dev: 3. 實作代碼 (Implement)
    Dev->>QA: 交付
    QA->>Spec: 查閱預期行為
    QA->>Dev: 4. 驗證結果 (Verify)
{mermaid}

h3. 關鍵思維：

* *Code is the implementation of Spec.* (程式碼只是規格的實作細節)
* 如果程式碼與規格不符，且程式碼運作正確，那麼 *是規格錯了，需要更新規格*，而不是只改程式碼。

----

h2. 3. 執行步驟 (Steps)

實施 Spec-Driven Development 的標準流程如下：

{mermaid}
flowchart LR
    S1[Step 1: 需求分析] --> S2[Step 2: 撰寫規格]
    S2 --> S3{Step 3: 規格審查}
    S3 -- 修改 --> S2
    S3 -- 通過 --> S4[Step 4: 實作開發]
    S4 --> S5[Step 5: 驗證測試]
    S5 --> Done((完成))
{mermaid}

h3. Step 1: 需求分析與草擬 (Requirement Analysis)

* *輸入*：使用者故事 (User Stories)、商業需求。
* *行動*：釐清「要做什麼 (What)」與「為什麼做 (Why)」。
* *產出*：初步功能列表、使用情境 (Use Cases)。

h3. Step 2: 撰寫詳細規格 (Spec Writing)

這是最關鍵的一步，需包含技術與非技術細節。

* *功能規格 (Functional Spec)*：
** 使用者旅程 (User Journey Maps)。
** UI/UX 流程圖 (Wireframes/Mockups)。
** 行為描述 (Edge cases, Error handling)。
* *技術規格 (Technical Spec)*：
** API 定義 (Endpoints, Request/Response examples)。
** 資料庫結構 (Schema Design)。
** 系統架構圖 (System Architecture)。
** *推薦工具*：Markdown, Mermaid.js (畫圖), Go API/Protobuf。

h3. Step 3: 規格審查 (Spec Review)

* *行動*：開發團隊與 Stakeholders 共同檢視規格。
* *重點*：
** 是否有遺漏的邊緣情況 (Edge cases)？
** 技術上是否可行？
** 邏輯是否自相矛盾？
* *產出*：已定案的規格書 (Frozen Spec)。

h3. Step 4: 實作 (Implementation)

* *行動*：根據定案的規格編寫程式碼。
* *特點*：此時工程師心智負擔較低，因為邏輯已在規格階段釐清，只需專注於程式碼品質與效能。

h3. Step 5: 驗證與測試 (Verification)

* *行動*：根據規格撰寫測試案例 (Test Cases)。
* *對照*：驗收標準 (Acceptance Criteria) 直接來自規格書。

----

h2. 4. 現今產品應用 (Now the product)

在當前的 AI 與現代軟體工程浪潮中，Specification Driven 的概念變得更加強大與重要：

{mermaid}
mindmap
  root((Spec-Driven<br/>產品應用))
    AI 輔助開發
      Cursor / Copilot
      自然語言轉程式碼
    API-First
      OpenAPI / Swagger
      前後端平行開發
    基礎設施即代碼 IaC
      Terraform / K8s
      狀態規格定義
    領域驅動設計 DDD
      Ubiquitous Language
      業務邏輯即代碼
{mermaid}

h3. 1. AI 輔助開發 (AI-Assisted Coding)

* *Cursor / GitHub Copilot*：
** 現在的開發模式常是：*「人類寫 Spec (Markdown/註解) -> AI 寫 Code」*。
** AI 模型非常擅長將清晰的自然語言描述 (Spec) 轉換為程式碼。
** *實例*：在 IDE 中寫下詳細的 Function docstring 或 {{.md}} 需求檔，讓 AI 自動生成對應的 class 或 function 實作。Spec 寫得越好，AI 寫的 Code 越準確。

h3. 2. API-First Development

* *OpenAPI (Swagger)*：
** 現代前後端分離開發，通常先定義 YAML/JSON 格式的 API Spec。
** 透過工具自動生成前端 SDK 與後端 Boilerplate code。
** 這就是典型的「規格驅動程式碼生成」。

h3. 3. 基礎設施即代碼 (Infrastructure as Code, IaC)

* *Terraform / Kubernetes YAML*：
** 我們撰寫的是「期望的狀態規格 (Desired State Spec)」，而非撰寫如何建立伺服器的腳本。
** 雲端系統負責將現況收斂至規格狀態。

h3. 4. 領域驅動設計 (Domain-Driven Design, DDD)

* 透過「通用語言 (Ubiquitous Language)」定義領域模型 (Business Spec)，確保程式碼變數命名與業務邏輯完全對應，讓程式碼本身就是可讀的規格。
